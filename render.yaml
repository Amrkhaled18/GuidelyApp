services:
  - type: web
    name: GuidelyApp
    runtime: node
    repo: https://github.com/Amrkhaled18/GuidelyApp
    plan: free
    buildCommand: |
      # Install .NET 8 SDK
      curl -sSL https://dot.net/v1/dotnet-install.sh | bash /dev/stdin --channel 8.0
      export PATH="$PATH:$HOME/.dotnet:$PATH"

      echo "=== Start Build in $(pwd) ==="
      cd FinalProjectTest

      # 🧪 Debug: List contents of current directory
      echo "🔍 Listing current directory:"
      pwd
      ls -la

      if [ -f "FinalProjectTest.csproj" ]; then
        echo "✅ Found FinalProjectTest.csproj"

        # React frontend build if ClientApp exists
        if [ -d "ClientApp" ]; then
          echo "⚙️ Building React frontend"
          cd ClientApp
          npm install
          npm run build
          cd ..
        fi

        echo "🚀 Publishing .NET project"
        ~/.dotnet/dotnet restore FinalProjectTest.csproj
        ~/.dotnet/dotnet publish FinalProjectTest.csproj -c Release -o ../publish
      else
        echo "❌ .csproj not found!"
        exit 1
      fi
    startCommand: cd publish && ~/.dotnet/dotnet FinalProjectTest.dll
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: "http://+:10000"
      - key: OpenAI__ApiKey
        value: "your-real-openai-key"
